# Práctica Analisis de Malware. Honeypot Cowrie

Nos conectamos por ssh a la IP del droplet creado


1. Creamos en DigitalOcean un droplet de Ubuntu. Nos conectamos por ssh a la IP de nuestra máquina creada: `104.248.199.134`
2. Update/upgrade desde la consola conectada a la máquina. Instalamos docker `sudo apt install docker.io`
3. Hacemos git clone del repo de cowrie de github --> `https://github.com/cowrie/cowrie.git` aqui ya tendremos la imagen
4. Si hacemos `docker images` podemos ver las imagenes q tenemos
5. Ahora tenemos que cambiar el puerto: `sudo iptables -t nat -A PREROUTING -p tcp -j REDIRECT --dport 22 --to-port 2222`
6. Copiar lo q hago en local en /pwd/cowrie_data se mete en:    /cowrie/cowrie-git/var con nombre "cowrie1". Ahora simplemente ya podemos correr el docker (ponemos el cowrie en funcionamiento) --> `docker run --name cowrie1 -d -p 2222:2222 -v $(pwd)/cowrie/var:/cowrie/cowrie-git/var cowrie/cowrie`
7. Podemos ver con `docker ps` el contenedor q acabamos de crear. Podemos meternos al contenedor con `docker exec -it cowrie1 bash` 'execute' y -it q significa 'interactive'
8. Si creamos algo en el ubuntu dentro de /cowrie_data , como hemos dicho se mete dentro del contenedor en /cowrie/cowrie-git/var (tenemos ya un 'prueba.txt' ahí dentro para comprobarlo)

Lo que hemos hecho es que internamente el tráfico que vaya a nuestro puerto 22 se redireccione al 2222 que es donde está levantado por dentro el contenedor del cowrie. Por lo que la gente que se conecte por ssh a la IP del dropplet se estará conectando realmente al honeypot, de esta forma ahí dentro podemos ver todo lo que los atacantes están realizando. Si dentro de la máquina hacemos un tree podemos ver en "downloads" las descargas que han realizado los atacantes. --> `~/cowrie/var/lib/cowrie/downloads`

En "tty" podemos ver las sesiones que la gente ha establecido (esto realmente está automatizado por los atacantes)

## Enlace de un ejemplo: https://medium.com/@galolbardes/learn-how-to-deploy-a-honeypot-and-visualise-its-data-step-by-step-ea3cd3f25822
