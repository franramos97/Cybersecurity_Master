# Herramientas para realizar análisis de malware y búsquedas avanzadas.

## 1. `File` determina el tipo de archivo buscando su número mágico:

![asd](https://user-images.githubusercontent.com/78214153/109981086-dc094880-7d00-11eb-8090-a92f45fffc58.PNG)

## 2. `du` determina el uso de disco de un archivo 

- `-s`: Muestra solamente el tamaño total de cada argumento
- `-h`: Muestra resultados legibles para humanos (Gigas, Bytes...)
- `--inodes`: Muestra el uso de los inodes en vez del tamaño de bloque
- `--apparent-size`: Muestra el tamaño aparente, si existen agujeros en archivos internos, fragmentación o bloques indirectos puede ser mayor que el tamaño de bloque

Si ejecutamos lo anterior junto con `| sort -h` nos muestra de mayor a menor (veré los más pesados primero)

## 3. `strings` busca cadenas de texto imprimibles o con delimitadores

- Para limpiar ciertos strings pequeños: `strings -n long_minima *` esto nos mostrará todos los strings mayores que esa long_minima (descartamos strings pequeños)

## 4. `rabin2`

Los ejecutables están divididos en secciones por ello hacemos uso de rabin2:

- `rabin2 -z`: Busca strings en la sección 'data' del ejecutable (.data)
- `rabin2 -zz`: Strings en el fichero 
- `rabin2 -zzz`: Muestra cadenas sin procesar (a lo bruto para ficheros enormes)
- `RABIN2_DEBASE64=1 rabind2 -zz * `: Coge los bloques que cree que sean de base 64 y los decodifica.

## 5. `grep`

Podemos buscar .exe, .ps1, IPs concretas, URLs...

### 5.1  `grep -E` == `regexp` ('regexp' está obsoleto)

Ejemplos uso de regex para análisis de malware LEER Y PONER AQUÍ: https://dzone.com/articles/regular-expressions-a-quick-intro-for-security-pro

#### Metacaracteres:

- `\d`: Pueden ser Nºs entre 0-9 --> \d = 4. \d\d = 67 \d\d\d= 139
- `\w`: Cualquier caracter alfa-numerico --> \w\w\w = dog
- `\s`: Cualquier espacio
- `\W`: En mayúscula, cualquier símbolo --> \W = #  \W\W = @~
- `[a-z]`: Al menos UNO entre a-z coincide pero no más. --> pand[ora] = 'panda' ó = 'pando' pero no puede ser pand[ora] = pandora
- `[0-9]`: Al menos UNO del 0-9 coincide pero no más. 
- `(abc)`: Coincida todo en ese orden --> pand(ora) = pandora
- `(123)`: Coincida todo en ese orden --> pand(123) = pand123
- `|`: 'OR' --> pand(abc|123) = pandabc OR pand123
- `?`: OPCIONAL, el caracter ANTERIOR al '?' puede no aparecer o sí aparecer --> colou?r = colour = color (salen con 'u' y sin 'u')
- `*`: Cuando el carácter ANTERIOR al ' * ' aparece 0 o MÁS veces (puede no aparecer) --> tre* = tr = tre = tree ...
- `+`: Igual que ' * ' pero aparece 1 o MÁS veces
- `.`: CREO que es igual que '\w', cualq carácter alfa-numerico --> ton. = tone = ton# = ton4
- `.*`: Combina '.' y ' * ' en ESE ORDEN --> tr.* = tr = treee = trkjafkjg
- `\`: Metacarácteres. Para añadir a la búsqueda caracteres que sean metacarácteres (todos los de esta lista ('+', '.', ' * '...) usamos `\` --> \+[0-9]{11} = +12345678901 (añade eñ '+' a la búsquda)

#### Quantificadores

- `{n}`: Muestra si el carácter anterior (o grupo de caracteres) ocurre las 'n' veces que indicamos --> \d{3} = 832 = 123 = 894 --> pand[ora]{2} = pandor = pandoo = pandra --> pand(ora){2} = pandoraora
- `{n,m}`: De 'n' a 'm' veces --> \d{2,5} = 94 = 831 = 8322 = 13245
- `{n, }`: 'n' o más veces











